doctype html
html(lang='en')
  head
    // Required meta tags
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, shrink-to-fit=no')
    title Unplug - The mental health self help platform
    meta(name='description', content='Unplug is the mental health self help platform')
    // Google font
    link(href='https://fonts.googleapis.com/css?family=K2D:300,400,500,700,800', rel='stylesheet')
    // Bootstrap CSS / Color Scheme
    link(rel='stylesheet', href='css/bootstrap.css')
  body
    // Header Section
    section.bg-gradient.pt-5.pb-6
      .container
        .row
          .col-12.d-flex.flex-row.align-items-center.justify-content-between
            .heading-brand Unplug
            a.btn.btn-dark(href='/', target='_blank') Talk to us.
        .row.mt-6
          .col-md-8.mx-auto.text-center
            h1 Mood Graphs
            p.lead.mb-5
              | Understanding your moods helps you manage them and feel better faster.
              | If you are more aware of your moods, you may be able to better manage your lifestyle choices,
              | make informed health decisions, prevent or avoid triggers of negative moods, and work towards a better quality of life.
        section.pb-1
          .container
            .row
              .col-md-8.mx-auto
                h3.text-center.text-md-left Quote of the Day:
                div.card.card-body
                  h2.text-center.text-md-left When the going gets tough, the tough get going.
                  p.lead.text-muted - Joseph P. Kennedy
        .row.mt-5
          .col-md-9.mx-auto
            .code-window
              .dots
                .red
                .orange
                .green
              br
              form(action="/", method="POST")
                div.form-group
                  label(for="feeling")
                    h3 What are you thinking today?
                  textarea.form-control(name="feeling", type="textarea", id="feeling", placeholder="Enter your thoughts", rows="10")
                button.btn.btn-success.svg-icon(type="submit")
                  em.mr-2(data-feather='send')
                  | Log in Mood Graph
    // Features Section
    section.py-6
      .container
        .row
          .col-md-8.mx-auto
            h2.text-center.text-md-left
              | Your Mood Graph for 
              span.text-success April 2021
            p.lead.text-muted How were you feeling this month?
            div.pb-3
                canvas(id="myChart")
            .row.pb-2
              div.card.card-body
                p.lead.text-muted Date:
                .col-sm-4.pb-3
                  select.custom-select(id="datething")
                p.lead(id="dater") You felt Unknown.
            .row.pb-2
                .col-md-12.mx-auto
                  if locals.feeling
                    if locals.failed
                      p.lead.text-muted Unable to identify emotions!
                    else
                      p.lead.text-muted Your thoughts indicated that you were feeling #{feeling}.
            section.pb-4
              .container
                .row
                  .col-md-12.mx-auto
                    h2.text-center.text-md-left Insights
                    p.lead.text-muted What does your mood graph show?
                    ul
                      li We have noticed that you've been feeling rather anxious in the past week. You mentioned that you liked "running" as a way to destress. Would you like to try out mindful running courses on the nike run club app?  ðŸ˜ƒ   
                        a(href="https://www.nike.com/nrc-app")
                            img(src='data:image/png;base64,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', alt='Nike Run Club', width="40px", style="border-radius:7px")
                      //li You've been feeling sad lately. You can try various activities to take your mind off the problems you face.
            .row
                .col-md-8.mx-auto
                  h2.text-center.text-md-left Legend
                  p.lead.text-muted What do these colours mean?
            div
              div.card.card-body
                .row.feature-grid
                  .col-sm-6
                    .media
                      .icon-box
                        .icon-box-inner
                          span(data-feather='smile', width='28', height='28', color="#98c379")
                      .media-body
                        | Joy
                  .col-sm-6
                    .media
                      .icon-box
                        .icon-box-inner
                          span(data-feather='frown', width='28', height='28', color="#61afef")
                      .media-body
                        | Sadness
                  .col-sm-6
                    .media
                      .icon-box
                        .icon-box-inner
                          span(data-feather='frown', width='28', height='28', color="#e06c75")
                      .media-body
                        | Anger
                  .col-sm-6
                    .media
                      .icon-box
                        .icon-box-inner
                          span(data-feather='meh', width='28', height='28', color='#e5c07b')
                      .media-body
                        | Anxious
                  .col-sm-6
                    .media
                      .icon-box
                        .icon-box-inner
                          span(data-feather='meh', width='28', height='28', color='#c9c2eb')
                      .media-body
                        | Unknown
    // Used By Section
    section.pb-6
      .container
        .row
          .col-md-8.mx-auto
            h2.text-center.text-md-left Recommended Resources
            p.lead.text-muted External resources to aid you
            ul
              li
                a.btn.btn-light(href='https://www.youtube.com/watch?v=SEfs5TJZ6Nk', target='_blank') 3-minute Mindful Breathing Meditation (Relieve Stress)
              li
                a.btn.btn-light(href='https://donothing.uk/', target='_blank') Mindfulness Resources for young people
              li
                a.btn.btn-light(href='https://www.youtube.com/playlist?list=PLsitozOnbmNOtNc18eeC6hZARCTGOyGeM', target='_blank') Mindfulness Practices with Gill Johnson
    // footer
    footer.py-5.bg-light
      .container
        .row
          .col-12.text-center
            ul.list-inline
              li.list-inline-item
                a(href='/') Mood Graph
              li.list-inline-item
                a(href='/users') Find Help
              li.list-inline-item
                a(href='/') About
        .row.my-2
          .col-md-4.mx-auto.text-muted.text-center.small-xl
            | Â© 2021 Unplug - All Rights Reserved
    // jQuery first, then Popper.js, then Bootstrap JS
    script(src='https://code.jquery.com/jquery-3.5.1.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/prism.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/plugins/line-numbers/prism-line-numbers.min.js')
    script(src='js/scripts.js')
    script(src="javascripts/chart.js")
    script.
      current = !{JSON.stringify(current)};
      while(current.length < 30) current.push("Unknown");
      console.log(current);

      const data = {
        datasets: [{
          label: 'Mood Graph',
          hoverOffset: 4
        }],
      }

      dataArray = []
      colourArray = []
      labelArray = []
      date = 1

      //background #282C34
      feelingColours = {
        "Joy": "#98c379",
        "Sadness": "#61afef",
        "Anger": "#e06c75",
        "Anxious": "#e5c07b",
        "Unknown": "#c9c2eb",
      }

      for(const feeling of current){
        dataArray.push(1);
        colourArray.push(feelingColours[feeling]);
        labelArray.push(date.toString() + "/4/2021");
        date += 1;
      }
      data.labels = labelArray;
      data.datasets[0].data = dataArray;
      data.datasets[0].backgroundColor = colourArray;
      
      const config = {
        type: 'doughnut',
        data: data,
        options: { 
          responsive: false,
          plugins: {
            legend: {
              display: false,
            },
          },
          animation: {
            animateScale: true,
          }
        },
        borderAlign: "center",
      };
      $(function() { 
          $('#datething').change(function() {
              feeling = $(this).val();
              if(feeling == "Unknown"){
                $('#dater').text("No feelings found for "+$("option:selected").text());
              } else {
                $('#dater').text("You were feeling "+feeling+" on "+$("option:selected").text());
              }
              $('#dater').css({"color":feelingColours[feeling]});
          }).change(); // Trigger the event
      });
      window.onload = function(){
        var myChart = new Chart(
          document.getElementById('myChart'),
          config
        );
        document.getElementById('myChart').style.margin = "auto";

        var select = document.getElementById("datething");
        date = 1;
        for(const feeling of current){
          var opt = date.toString()+"/4/2021";
          date += 1;
          var el = document.createElement("option");
          el.textContent = opt;
          el.value = feeling;
          select.appendChild(el);
        }
      }